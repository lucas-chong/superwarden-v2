const Account=require("../model/account.model"),Townhall=require("../model/townhall.model");async function updateProfile(e,o,n){try{Account.findOneAndUpdate({address:e.body._addr},e.body.account).then((async e=>{o.json({account:e})}))}catch(e){console.log("api/controller/user.controller/updateProfile"+e)}}async function getProfile(e,o,n){try{Account.findOne({address:e.body._addr}).then((async e=>{e.id&&Townhall.find({villagers:e._id}).exec().then((n=>{o.json({townhalls:n,account:e})}))}))}catch(e){console.log("api/controller/user.controller/getProfile"+e)}}async function getAccountData(e,o,n){try{Account.findOne({address:e.body._addr}).then((async n=>{if(n)Townhall.find({villagers:n._id}).select("_id superwarden details.avatar details.slug").exec().then((e=>{o.json({account:n,townhalls:e})})).catch((e=>console.error(e)));else{let n=new Account({address:e.body._addr});await n.save().then((e=>{o.json({account:e,townhalls:[]})}))}}))}catch(e){console.log("api/controller/user.controller/getData"+e)}}async function sample(e,o,n){try{await user.save(),User.find({}).then((e=>{console.log(e)}));o.json({list:"okay"})}catch(e){console.log("api/controller/user.controller/sample"+e)}}module.exports={getAccountData:getAccountData,getProfile:getProfile,updateProfile:updateProfile};